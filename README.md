# Unity EEG实时脑电信号处理系统

## 项目概述

这是一个基于Unity框架的实时脑电信号处理系统，用于接收、处理和分析来自ESP32的脑电信号数据。系统支持实时数据解码、信号滤波、特征提取、机器学习推理和可视化显示。

## 系统架构

### 核心模块

1. **UDP通信模块** (`UDP_1.cs`)
   - 接收ESP32发送的UDP数据包
   - 支持多线程异步接收
   - 自动数据队列管理

2. **数据解析模块** (`EEGDataParser.cs`)
   - 解析ESP32数据包格式
   - 支持多通道数据提取
   - CRC校验和数据验证

3. **数据管理模块** (`EEGDataManager.cs`)
   - 多通道EEG数据管理
   - 实时数据缓冲和更新
   - 数据统计和监控

4. **信号处理模块** (`EEGSignalProcessor.cs`)
   - 实时信号滤波（高通、低通、带通）
   - 特征提取（时域、频域）
   - FFT频谱分析

5. **机器学习推理模块** (`EEGMLInference.cs`)
   - 实时脑电信号分类
   - 支持多种分类算法
   - 置信度评估

6. **可视化模块** (`EEGVisualizer.cs`)
   - 实时波形显示
   - 多通道数据可视化
   - 交互式参数调节

7. **系统控制器** (`EEGSystemController.cs`)
   - 统一系统管理
   - 模块间协调
   - 状态监控和配置

8. **测试数据生成器** (`EEGTestDataGenerator.cs`)
   - 模拟ESP32数据包
   - 多种测试信号模式
   - 类别特定信号生成

## 数据格式

### ESP32数据包结构

每个数据包包含4个通道的数据，每个通道对应47字节：

```
[2字节帧头] [3字节序列号] [1字节通道号] [2字节数据长度] [30字节EEG数据] [8字节时间戳] [1字节CRC]
```

- **帧头**: `0xAD 0xAD`
- **序列号**: 3字节递增序列号
- **通道号**: 0-3，对应4个EEG通道
- **数据长度**: 固定为30字节
- **EEG数据**: 30字节，每3字节对应一个采样点（24位有符号整数）
- **时间戳**: 8字节时间戳
- **CRC**: 1字节校验和

### 示例数据包

```
AD AD 00 00 00 00 00 1E 21 94 42 27 E8 07 2B 0B D1 2B CE FD 29 B8 47 23 5E 6C 17 3D 65 04 A8 62 EC 6A 41 D0 CC A2 00 00 00 00 10 09 84 19 F8
```

## 安装和配置

### 系统要求

- Unity 2021.3 LTS 或更高版本
- .NET Framework 4.7.1 或更高版本
- Windows 10/11

### 安装步骤

1. 克隆项目到本地
2. 在Unity中打开项目
3. 确保所有脚本文件都在正确的目录结构中
4. 配置UDP接收参数（IP地址和端口）

### 配置参数

#### UDP设置
- **监听IP**: `192.168.1.89` (默认)
- **监听端口**: `30300` (默认)

#### 信号处理参数
- **低通滤波截止频率**: 50Hz
- **高通滤波截止频率**: 1Hz
- **FFT窗口大小**: 256点

#### 机器学习参数
- **推理间隔**: 0.1秒
- **置信度阈值**: 0.7
- **特征窗口大小**: 100

## 使用方法

### 基本使用

1. **启动系统**
   - 在Unity编辑器中运行场景
   - 点击"启动系统"按钮
   - 系统开始监听UDP数据

2. **数据接收**
   - ESP32开始发送数据包
   - 系统自动解析和处理数据
   - 实时显示波形和统计信息

3. **查看结果**
   - 波形显示区域显示实时EEG信号
   - 推理结果区域显示分类结果
   - 状态信息区域显示系统状态

### 测试模式

1. **启用测试数据**
   - 在Inspector中勾选"启用测试数据"
   - 选择测试模式（正弦波、方波、随机噪声、类别特定）
   - 设置测试类别（0-4）

2. **测试信号模式**
   - **正弦波**: 标准正弦波信号
   - **方波**: 方波信号
   - **随机噪声**: 随机噪声信号
   - **类别特定**: 根据类别生成特定信号

### 高级配置

#### 信号处理配置
```csharp
// 在EEGSignalProcessor中配置
signalProcessor.lowPassCutoff = 50f;    // 低通滤波
signalProcessor.highPassCutoff = 1f;    // 高通滤波
signalProcessor.enableFiltering = true;  // 启用滤波
```

#### 机器学习配置
```csharp
// 在EEGMLInference中配置
mlInference.inferenceInterval = 0.1f;     // 推理间隔
mlInference.confidenceThreshold = 0.7f;   // 置信度阈值
mlInference.enableInference = true;       // 启用推理
```

## 系统特性

### 实时处理
- 支持250Hz采样率
- 低延迟数据处理
- 多线程异步处理

### 信号质量
- 自动噪声抑制
- 信号滤波和增强
- 数据完整性校验

### 可视化
- 实时波形显示
- 多通道同步显示
- 交互式参数调节

### 机器学习
- 实时特征提取
- 多类别分类
- 置信度评估

## 扩展开发

### 添加新的信号处理算法

1. 在`EEGSignalProcessor.cs`中添加新方法
2. 实现信号处理算法
3. 在`ProcessEEGData`方法中调用

### 集成新的机器学习模型

1. 在`EEGMLInference.cs`中修改`ExecuteInference`方法
2. 加载训练好的模型文件
3. 实现模型推理逻辑

### 添加新的可视化组件

1. 创建新的可视化脚本
2. 继承或参考`EEGVisualizer.cs`
3. 在`EEGSystemController.cs`中集成

## 故障排除

### 常见问题

1. **UDP连接失败**
   - 检查IP地址和端口配置
   - 确认ESP32正在发送数据
   - 检查防火墙设置

2. **数据解析错误**
   - 检查数据包格式是否正确
   - 验证CRC校验
   - 确认数据长度

3. **性能问题**
   - 调整更新间隔
   - 减少调试日志
   - 优化信号处理参数

### 调试模式

启用调试日志以获取详细信息：
```csharp
systemController.enableDebugLog = true;
```

## 技术规格

### 性能指标
- **数据处理延迟**: < 10ms
- **内存使用**: < 100MB
- **CPU使用率**: < 20%

### 支持的数据格式
- **采样率**: 250Hz
- **分辨率**: 24位
- **通道数**: 4通道
- **数据包大小**: 188字节（4通道×47字节）

### 分类类别
- **类别0**: 休息
- **类别1**: 左转
- **类别2**: 右转
- **类别3**: 前进
- **类别4**: 后退

## 许可证

本项目采用MIT许可证。详见LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request来改进项目。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 发送邮件至项目维护者

---

**注意**: 本系统仅用于研究和教育目的。在实际医疗应用中，请确保符合相关法规和标准。
